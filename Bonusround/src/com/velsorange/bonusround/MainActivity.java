package com.velsorange.bonusround;

import android.os.Bundle;
import android.app.Activity;
import android.app.ListActivity;
import android.content.Context;
import android.content.Intent;
import android.content.SharedPreferences;
import android.content.SharedPreferences.Editor;
import android.content.res.Configuration;
import android.database.Cursor;
import android.support.v4.widget.SimpleCursorAdapter;
import android.util.DisplayMetrics;
import android.util.Log;
import android.view.Menu;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.TextView;
import android.widget.Toast;

public class MainActivity extends ListActivity {
	
	private static Cursor c = null;
	private static String nev = "";
	private static String admin = "";
	private static String vetelezes = "";
	private static String standolas = "";
	private static String koltseg = "";
	private static String bevetel = "";
	private static String informaciok = "";
	public static DbAdapter dbHelper;
	
	public static String fejlec = "Üdvözletem:)";
	public String[] values;
	public boolean oarcbor;
	public static final int TABLET_MIN_DP_WEIGHT = 450;
	private SimpleCursorAdapter dataAdapter;

	protected static boolean isSmartphoneOrTablet(Activity act) {
		DisplayMetrics metrics = new DisplayMetrics();
		act.getWindowManager().getDefaultDisplay().getMetrics(metrics);

		int dpi = 0;
		if (metrics.widthPixels < metrics.heightPixels) {
			dpi = (int) (metrics.widthPixels / metrics.density);
		} else {
			dpi = (int) (metrics.heightPixels / metrics.density);
		}

		if (dpi < TABLET_MIN_DP_WEIGHT)
			return true;
		else
			return false;
	}

	@Override
	public void onConfigurationChanged(Configuration newConfig) {
		super.onConfigurationChanged(newConfig);

		oarcbor = true;
		if (newConfig.orientation == Configuration.ORIENTATION_LANDSCAPE) {
			Toast.makeText(this, "landscape", Toast.LENGTH_SHORT).show();
		} else if (newConfig.orientation == Configuration.ORIENTATION_PORTRAIT) {
			Toast.makeText(this, "portrait", Toast.LENGTH_SHORT).show();
		}
	}

	protected void onResume() {
		super.onResume();

		if (!oarcbor) {
			// kívûrõl érkezünk
			nev = "Nincs bejelentkezve";
			admin = "false";
			fejlec = "Üdvözletem:)";
			vetelezes = "false";
			standolas = "false";
			koltseg = "false";
			bevetel = "false";
			informaciok = "false";

		} else {
		}
		oarcbor = false;
		menu();
		Log.d("menu futása", "onResume-ben után");

		c = null;
		if (dbHelper.getUserId(nev) == 0) {
		} else {
			c = dbHelper.fetchFoMenu(dbHelper.getUserId(nev));
		}

		/*
		 * if (admin.compareTo("true") == 0) { values = new String[] {
		 * "Bónuszkör", "Vételezés", "Standolás", "Hitel", "Költség", "Bevétel",
		 * "Információk", "Karbantartás", "Kijelentkezés", "Kilépés" }; } else
		 * if (nev == "Nincs bejelentkezve") { values = new String[] {
		 * "Bejelenkezés", "Kilépés" };
		 * 
		 * } else if (nev == "Nincs felhasználó") { values = new String[] {
		 * "Új felhasználó", "Kilépés" };
		 * 
		 * } else if (admin.compareTo("false") == 0) { String s="\"Bónuszkör\"";
		 * int db=3; if (vetelezes=="true"){ db++; } if (standolas=="true"){
		 * db++; } db++; if (koltseg=="true"){ db++; } if (bevetel=="true"){
		 * db++; } if (informaciok=="true"){ db++; } values = new String[db];
		 * values[0]="Bónuszkör"; values[db-1]="Kilépés";
		 * values[db-2]="Kijelentkezés"; db=0; if (vetelezes=="true"){ db++;
		 * values[db]="Vételezés"; } if (standolas=="true"){ db++;
		 * values[db]="Standolás"; } db++; values[db]="Hitel"; if
		 * (koltseg=="true"){ db++; values[db]="Költség"; } if
		 * (bevetel=="true"){ db++; values[db]="Bevétel"; } if
		 * (informaciok=="true"){ db++; values[db]="Információk"; }
		 * 
		 * values = new String[] { "Bónuszkör", "Vételezés", "Standolás",
		 * "Hitel", "Költség", "Kijelentkezés", "Kilépés" }; }
		 */

		if (c == null) {

		} else {

			String[] columns = new String[2];
			columns[0] = dbHelper.MENU_KEY_ROWID;
			columns[1] = dbHelper.MENU_KEY_MENU;

			// the XML defined views which the data will be bound to
			int[] to = new int[2];
			to[0] = R.id.tablaid;
			to[1] = R.id.fomenu;

			// create the adapter using the cursor pointing to the desired data
			// as well as the layout information
			setContentView(R.layout.activity_main);
			dataAdapter = new SimpleCursorAdapter(this, R.layout.fomenusor, c,
					columns, to, 0);

			ListView listView = (ListView) findViewById(android.R.id.list);
			// Assign adapter to ListView
			listView.setAdapter(dataAdapter);
			/*
			 * setListAdapter(new ArrayAdapter<String>(this,
			 * R.layout.activity_main, values));
			 * 
			 * ListView listView = getListView();
			 */
			// listView.setTextFilterEnabled(true);
			listView.setOnItemClickListener(new OnItemClickListener() {
				public void onItemClick(AdapterView<?> parent, View view,
						int position, long i) {
					menuValaszt(position);
				}
			});
		}
	}

	public void menuValaszt(int i) {
		c.moveToPosition(i);
		String szoveg = c.getString(1);
		if (szoveg.compareTo("Bónuszkör") == 0) {

		} else if (szoveg.compareTo("Vételezés") == 0) {
		} else if (szoveg.compareTo("Standolás") == 0) {
		} else if (szoveg.compareTo("Hitel") == 0) {
		} else if (szoveg.compareTo("Költség") == 0) {
		} else if (szoveg.compareTo("Bevétel") == 0) {
		} else if (szoveg.compareTo("Információk") == 0) {
		} else if (szoveg.compareTo("Karbantartás") == 0) {
			Intent intent = new Intent(getBaseContext(), Karbantartas.class);
			Bundle b = new Bundle();
			b.putString("nev", nev);
			intent.putExtras(b);
			startActivityForResult(intent, 4);
			Toast.makeText(this, "Karbantartás", Toast.LENGTH_LONG)
					.show();
		} else if (szoveg.compareTo("Kijelentkezés") == 0) {
			Intent intent = new Intent(getBaseContext(), LoginActivity.class);
			startActivityForResult(intent, 3);
			Toast.makeText(this, "Sikeres kijelentkezés!", Toast.LENGTH_LONG)
					.show();
		} else if (szoveg.compareTo("Kilépés") == 0) {
			finish();
			Toast.makeText(this, "Sikeres kilépés!", Toast.LENGTH_LONG).show();
		}
	}

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		dbHelper = new DbAdapter(this);
		dbHelper.open();
	}

	@Override
	protected void onDestroy() {
		super.onDestroy();
	}

	private void menu() {
		//dbHelper = new DbAdapter(this);
		//dbHelper.open();
		if ((dbHelper.osszFelhasznalok().getCount() > 0)
				&& (fejlec.compareTo("Üdvözletem:)") == 0)
				&& (nev.isEmpty() || nev.compareTo("Nincs bejelentkezve") == 0)) {
			this.setTitle("Nincs bejelentkezve");
			Intent intent = new Intent(getBaseContext(), LoginActivity.class);
			startActivityForResult(intent, 3);
		} else if ((dbHelper.osszFelhasznalok().getCount() == 0)) {
			Log.d("mainactivity", "újfelhasznaló.class indít");
			Intent intent = new Intent(getBaseContext(), UjFelhasznalo.class);
			startActivityForResult(intent, 2);
		} else
			setTitle(nev);
	}

	@Override
	protected void onActivityResult(int requestCode, int resultCode, Intent data) {
		oarcbor = true;
		if (resultCode == RESULT_CANCELED) {
		} else {
			if (requestCode == 2) {
				Bundle MBuddle = data.getExtras();
				nev = MBuddle.getString("nev");
				admin = MBuddle.getString("admin");
				fejlec = "";
			}
			if (requestCode == 3) {
				Bundle MBuddle = data.getExtras();
				nev = MBuddle.getString("nev");
				admin = MBuddle.getString("admin");
				fejlec = "";
			}
			if (requestCode == 4) {
				Bundle MBuddle = data.getExtras();
				nev = MBuddle.getString("nev");
				fejlec = "";
			}
		}
	}

	@Override
	public boolean onCreateOptionsMenu(Menu menu) {
		// Inflate the menu; this adds items to the action bar if it is present.
		getMenuInflater().inflate(R.menu.activity_main, menu);
		return true;
	}
}
